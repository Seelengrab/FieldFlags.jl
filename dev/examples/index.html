<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Examples · FieldFlags.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">FieldFlags.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">FieldFlags.jl Documentation</a></li><li class="is-active"><a class="tocitem" href>Examples</a><ul class="internal"><li><a class="tocitem" href="#[@bitflags](@ref)"><span><code>@bitflags</code></span></a></li><li><a class="tocitem" href="#[@bitfield](@ref)"><span><code>@bitfield</code></span></a></li></ul></li><li><a class="tocitem" href="../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Examples</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Examples</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Seelengrab/FieldFlags.jl/blob/main/docs/src/examples.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h1><h2 id="[@bitflags](@ref)"><a class="docs-heading-anchor" href="#[@bitflags](@ref)"><a href="../api/#FieldFlags.@bitflags"><code>@bitflags</code></a></a><a id="[@bitflags](@ref)-1"></a><a class="docs-heading-anchor-permalink" href="#[@bitflags](@ref)" title="Permalink"></a></h2><h3 id="Immutable"><a class="docs-heading-anchor" href="#Immutable">Immutable</a><a id="Immutable-1"></a><a class="docs-heading-anchor-permalink" href="#Immutable" title="Permalink"></a></h3><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using FieldFlags</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @bitflags struct MyFlags
           a
           b
           _
           c
       end</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; FieldFlags.propertyoffset.(MyFlags, (:a, :b, :c))</code><code class="nohighlight hljs ansi" style="display:block;">(0, 1, 3)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; FieldFlags.fieldsize.(MyFlags, (:a, :b, :c))</code><code class="nohighlight hljs ansi" style="display:block;">(1, 1, 1)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; (;a,b,c) = flags = MyFlags(true, false, true)</code><code class="nohighlight hljs ansi" style="display:block;">Main.MyFlags(a: true, b: false, c: true)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; sizeof(flags)</code><code class="nohighlight hljs ansi" style="display:block;">1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a, b, c</code><code class="nohighlight hljs ansi" style="display:block;">(true, false, true)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; flags.a = false</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: setfield!: immutable struct of type MyFlags cannot be changed</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; flags.a</code><code class="nohighlight hljs ansi" style="display:block;">true</code></pre><h3 id="Mutable"><a class="docs-heading-anchor" href="#Mutable">Mutable</a><a id="Mutable-1"></a><a class="docs-heading-anchor-permalink" href="#Mutable" title="Permalink"></a></h3><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using FieldFlags</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @bitflags mutable struct MyFlags
           a
           b
           _
           c
       end</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; (;a,b,c) = flags = MyFlags(true, false, true)</code><code class="nohighlight hljs ansi" style="display:block;">Main.MyFlags(a: true, b: false, c: true)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; sizeof(flags)</code><code class="nohighlight hljs ansi" style="display:block;">1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a, b, c</code><code class="nohighlight hljs ansi" style="display:block;">(true, false, true)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; flags.a = false</code><code class="nohighlight hljs ansi" style="display:block;">false</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; flags.a</code><code class="nohighlight hljs ansi" style="display:block;">false</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; flags.b = 0x3</code><code class="nohighlight hljs ansi" style="display:block;">0x03</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; flags.b # `setproperty!` truncates</code><code class="nohighlight hljs ansi" style="display:block;">true</code></pre><h2 id="[@bitfield](@ref)"><a class="docs-heading-anchor" href="#[@bitfield](@ref)"><a href="../api/#FieldFlags.@bitfield"><code>@bitfield</code></a></a><a id="[@bitfield](@ref)-1"></a><a class="docs-heading-anchor-permalink" href="#[@bitfield](@ref)" title="Permalink"></a></h2><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using FieldFlags</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @bitfield mutable struct MyField
           a:1
           b:3
           _
           c:9
       end</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; FieldFlags.propertyoffset.(MyField, (:a, :b, :c))</code><code class="nohighlight hljs ansi" style="display:block;">(0, 1, 4)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; FieldFlags.fieldsize.(MyField, (:a, :b, :c))</code><code class="nohighlight hljs ansi" style="display:block;">(1, 3, 9)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # 1+3+1+9 = 13, so we need two bytes
       sizeof(MyField)</code><code class="nohighlight hljs ansi" style="display:block;">2</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; (;a,b,c) = field = MyField(0, 4, 19)</code><code class="nohighlight hljs ansi" style="display:block;">Main.MyField(a: false, b: 0x4, c: 0x13)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # field access either returns a `Bool` or an `UInt`
       a,b,c</code><code class="nohighlight hljs ansi" style="display:block;">(false, 0x0000000000000004, 0x0000000000000013)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; field.b = 0xff</code><code class="nohighlight hljs ansi" style="display:block;">0xff</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; field.b</code><code class="nohighlight hljs ansi" style="display:block;">0x0000000000000007</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # only the lower three bits are stored
       bitstring.((0xff, 0x07))</code><code class="nohighlight hljs ansi" style="display:block;">(&quot;11111111&quot;, &quot;00000111&quot;)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; f(x) = x.c</code><code class="nohighlight hljs ansi" style="display:block;">f (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; using InteractiveUtils</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # everything compiles away by the time it reaches LLVM
       @code_llvm f(field)</code><code class="nohighlight hljs ansi" style="display:block;"></code><code class="nohighlight hljs ansi" style="display:block;"></code><code class="nohighlight hljs ansi" style="display:block;"></code><code class="nohighlight hljs ansi" style="display:block;"></code><code class="nohighlight hljs ansi" style="display:block;"></code><code class="nohighlight hljs ansi" style="display:block;"><span class="sgr90">;  @ REPL[11]:1 within `f`</span>
<span class="sgr95">define</span> <span class="sgr36">i64</span> <span class="sgr93">@julia_f_1665</span><span class="sgr33">({}</span>* <span class="sgr95">noundef</span> <span class="sgr95">nonnull</span> <span class="sgr95">align</span> <span class="sgr33">2</span> <span class="sgr95">dereferenceable</span><span class="sgr33">(2)</span> %0<span class="sgr33">)</span> #0 <span class="sgr33">{</span>
<span class="sgr91">top:</span>
<span class="sgr90">; ┌ @ /home/runner/work/FieldFlags.jl/FieldFlags.jl/src/FieldFlags.jl:322 within `getproperty`</span>
   %1 = <span class="sgr96"><span class="sgr1">bitcast</span></span> <span class="sgr33">{}</span>* %0 <span class="sgr95">to</span> <span class="sgr36">i16</span>*
   %2 = <span class="sgr96"><span class="sgr1">load</span></span> <span class="sgr36">i16</span>, <span class="sgr36">i16</span>* %1, <span class="sgr95">align</span> <span class="sgr33">2</span>
<span class="sgr90">; │ @ /home/runner/work/FieldFlags.jl/FieldFlags.jl/src/FieldFlags.jl:224 within `getproperty`</span>
   %3 = <span class="sgr96"><span class="sgr1">lshr</span></span> <span class="sgr36">i16</span> %2, <span class="sgr33">4</span>
<span class="sgr90">; │ @ /home/runner/work/FieldFlags.jl/FieldFlags.jl/src/FieldFlags.jl:227 within `getproperty`</span>
   %4 = <span class="sgr96"><span class="sgr1">and</span></span> <span class="sgr36">i16</span> %3, <span class="sgr33">511</span>
<span class="sgr90">; │ @ /home/runner/work/FieldFlags.jl/FieldFlags.jl/src/FieldFlags.jl:228 within `getproperty`</span>
<span class="sgr90">; │┌ @ /home/runner/work/FieldFlags.jl/FieldFlags.jl/src/FieldFlags.jl:84 within `cast_extend_truncate`</span>
    %5 = <span class="sgr96"><span class="sgr1">zext</span></span> <span class="sgr36">i16</span> %4 <span class="sgr95">to</span> <span class="sgr36">i64</span>
<span class="sgr90">; └└</span>
  <span class="sgr96"><span class="sgr1">ret</span></span> <span class="sgr36">i64</span> %5
<span class="sgr33">}</span></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # the native code is efficient
       @code_native f(field)</code><code class="nohighlight hljs ansi" style="display:block;"></code><code class="nohighlight hljs ansi" style="display:block;"></code><code class="nohighlight hljs ansi" style="display:block;"></code><code class="nohighlight hljs ansi" style="display:block;"></code><code class="nohighlight hljs ansi" style="display:block;">	.text
	.file	&quot;f&quot;
	.globl	julia_f_1708                    <span class="sgr90"># -- Begin function julia_f_1708</span>
	.p2align	<span class="sgr33">4</span>, <span class="sgr33">0x90</span>
	.type	julia_f_1708,@function
<span class="sgr91">julia_f_1708:</span>                           <span class="sgr90"># @julia_f_1708</span>
<span class="sgr90">; ┌ @ REPL[11]:1 within `f`</span>
	.cfi_startproc
<span class="sgr90"># %bb.0:                                # %top</span>
	<span class="sgr96"><span class="sgr1">pushq</span></span>	%rbp
	.cfi_def_cfa_offset <span class="sgr33">16</span>
	.cfi_offset %rbp, <span class="sgr33">-16</span>
	<span class="sgr96"><span class="sgr1">movq</span></span>	%rsp, %rbp
	.cfi_def_cfa_register %rbp
<span class="sgr90">; │┌ @ /home/runner/work/FieldFlags.jl/FieldFlags.jl/src/FieldFlags.jl:224 within `getproperty`</span>
	<span class="sgr96"><span class="sgr1">movzwl</span></span>	<span class="sgr33">(</span>%rdi<span class="sgr33">)</span>, %eax
	<span class="sgr96"><span class="sgr1">shrl</span></span>	<span class="sgr33">$4</span>, %eax
	<span class="sgr96"><span class="sgr1">andl</span></span>	<span class="sgr33">$511</span>, %eax                      <span class="sgr90"># imm = 0x1FF</span>
<span class="sgr90">; │└</span>
	<span class="sgr96"><span class="sgr1">popq</span></span>	%rbp
	.cfi_def_cfa %rsp, <span class="sgr33">8</span>
	<span class="sgr96"><span class="sgr1">retq</span></span>
<span class="sgr91">.Lfunc_end0:</span>
	.size	julia_f_1708, .Lfunc_end0-julia_f_1708
	.cfi_endproc
<span class="sgr90">; └</span>
                                        <span class="sgr90"># -- End function</span>
	.section	&quot;.note.GNU-stack&quot;,&quot;&quot;,@progbits</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« FieldFlags.jl Documentation</a><a class="docs-footer-nextpage" href="../api/">API Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Wednesday 31 May 2023 07:49">Wednesday 31 May 2023</span>. Using Julia version 1.9.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
